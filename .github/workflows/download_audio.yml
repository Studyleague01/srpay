name: Download Audio File
on:
  workflow_dispatch:
    inputs:
      video_id:
        description: 'Enter video ID'
        required: true
        type: string
jobs:
  download:
    runs-on: ubuntu-latest
    permissions:
      contents: write
    steps:
      - uses: actions/checkout@v4

      - name: Install yt-dlp and ffmpeg
        run: |
          sudo apt update
          sudo apt install -y yt-dlp ffmpeg

      - name: Create directory
        run: mkdir -p downloads

      - name: Download audio
        run: |
          yt-dlp -f bestaudio -x --audio-format mp3 -o "downloads/${{ github.event.inputs.video_id }}.mp3" "https://www.youtube.com/watch?v=${{ github.event.inputs.video_id }}"

      - name: Setup git
        run: |
          git config --global user.name 'github-actions[bot]'
          git config --global user.email 'github-actions[bot]@users.noreply.github.com'

      - name: Commit files
        run: |
          git add downloads/
          git diff --staged --quiet || (git commit -m "Added audio file ${{ github.event.inputs.video_id }}.mp3" && git push)
